<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Funko Pops Personalizados | Artesan√≠a √∫nica</title>
    <meta name="description" content="Funko Pops personalizados hechos a mano. Dise√±os exclusivos: bodas, cantantes, custom y pel√≠culas." />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Cormorant+Garamond:ital,wght@0,400;0,600;1,400&family=Source+Serif+4:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet" />
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}" />
  </head>
  <body>
    <header class="header">
      <div class="container header__content">
        <a href="#inicio" class="header__brand">
          <img src="{{ logo_url }}" alt="Funko Pops Custom" class="header__logo-img" width="48" height="48" />
          <div>
            <span class="header__title">Funko Pops Custom</span>
            <span class="header__subtitle">Artesan√≠a hecha a mano</span>
          </div>
        </a>
        <nav class="nav" aria-label="Navegaci√≥n principal">
          <button class="nav__toggle" aria-label="Abrir men√∫" id="navToggle"><span></span><span></span></button>
          <ul class="nav__list" id="navList">
            <li><a href="#como-funciona">C√≥mo funciona</a></li>
            <li><a href="#dise√±os">Dise√±os</a></li>
            <li><a href="#elegir">Descubre nuestro trabajo</a></li>
          </ul>
        </nav>
        <div class="header__right">
          <a href="https://gemini.google.com" target="_blank" rel="noopener noreferrer" class="header__gemini-btn" aria-label="Abrir Gemini para crear referencia con IA">‚ú® IA</a>
          <a href="{{ url_for('carrito') }}" class="header__cart" aria-label="Ver carrito">
            <span class="header__cart-icon">üõí</span>
            <span class="header__cart-count" id="cartCount">{{ cart_count }}</span>
          </a>
        </div>
      </div>
    </header>

    <main>
      <!-- Hero -->
      <section id="inicio" class="hero">
        <div class="container hero__wrap">
          <div class="hero__col hero__col--img">
            <div class="hero__image-wrap">
              <img src="{{ hero_image }}" alt="Funko Pops personalizados" class="hero__image" width="420" height="315" />
            </div>
          </div>
          <div class="hero__col hero__col--text">
            <h1 class="hero__title">Funko Pops personalizados</h1>
            <p class="hero__desc">
              Creamos figuras √∫nicas hechas a mano: novios para tu boda, tu artista favorito, tu mascota, personajes de cine o un dise√±o 100 % personal. Cada pieza se esculpe, pinta y acaba en nuestro taller.
            </p>
            <div class="hero__actions">
              <a href="#dise√±os" class="button">Ver dise√±os</a>
              <a href="{{ url_for('carrito') }}" class="button button--outline">Ver carrito</a>
            </div>
          </div>
          <div class="hero__col hero__col--video">
            <div class="hero__video-wrap">
              <video autoplay muted loop playsinline preload="auto" class="hero__video" aria-label="V√≠deo del proceso">
                <source src="{{ hero_video }}" type="video/mp4" />
              </video>
            </div>
          </div>
        </div>
      </section>

      <!-- C√≥mo funciona -->
      <section id="como-funciona" class="section section--steps">
        <div class="container">
          <header class="section__header">
            <h2>¬øC√≥mo funciona?</h2>
            <p>Te lo ponemos muy f√°cil: en tres pasos tendr√°s tu Funko en casa.</p>
          </header>
          {% if instrucciones_imagenes and instrucciones_imagenes|length >= 2 %}
          <div class="steps-images">
            <div class="steps-images__wrap">
              <img src="{{ instrucciones_imagenes[0] }}" alt="Instrucciones paso a paso" class="steps-images__img" loading="lazy" />
              <img src="{{ instrucciones_imagenes[1] }}" alt="Instrucciones de encargo" class="steps-images__img" loading="lazy" />
            </div>
          </div>
          {% endif %}
          <div class="steps">
            <div class="step">
              <span class="step__num">1</span>
              <h3 class="step__title">Elige y a√±ade al carrito</h3>
              <p class="step__text">Elige una categor√≠a aqu√≠ abajo y a√±√°dela al carrito. Si quieres una referencia con IA, usa el bot√≥n ‚ú® IA del encabezado para abrir Gemini en la misma p√°gina y genera tu idea. Luego podr√°s pegarla en la ficha del carrito.</p>
            </div>
            <div class="step">
              <span class="step__num">2</span>
              <h3 class="step__title">Rellena la ficha en el carrito</h3>
              <p class="step__text">En el carrito rellena tus datos: descripci√≥n del Funko, sube im√°genes de referencia si tienes y tu direcci√≥n de env√≠o. Esos datos se nos env√≠an por correo y t√∫ pasas al pago.</p>
            </div>
            <div class="step">
              <span class="step__num">3</span>
              <h3 class="step__title">Paga y te lo enviamos</h3>
              <p class="step__text">Paga con tarjeta o PayPal y nosotros te enviamos tu figura a casa. Env√≠os a toda Espa√±a e internacionales.</p>
            </div>
          </div>
        </div>
      </section>

      <!-- Galer√≠a -->
      <section id="dise√±os" class="section section--cream">
        <div class="container">
          <header class="section__header">
            <h2>Nuestros dise√±os</h2>
            <p>Elige una categor√≠a, mira los ejemplos y a√±ade al carrito la que te guste. Cada una tiene su precio.</p>
          </header>
          <div class="grupos" id="grupos">
            {% for grupo in grupos %}
            <details class="grupo" data-grupo="{{ grupo.id }}"{% if not grupo.resto %} data-sin-resto{% endif %}>
              <summary class="grupo__portada">
                <span class="grupo__img-wrap">
                  <img src="{{ grupo.imagen_principal.url }}" alt="{{ grupo.nombre }}" loading="lazy" width="320" height="320" />
                  {% if grupo.resto %}<span class="grupo__ver-mas">Ver m√°s</span>{% endif %}
                </span>
                <span class="grupo__info">
                  <span class="grupo__nombre">{{ grupo.nombre }}</span>
                  <span class="grupo__desc">{{ grupo.descripcion }}</span>
                  <span class="grupo__precio">{{ grupo.precio }} ‚Ç¨</span>
                  <form action="{{ url_for('carrito_add_product') }}" method="post" class="grupo__add" onclick="event.stopPropagation()">
                    <input type="hidden" name="grupo_id" value="{{ grupo.id }}" />
                    <button type="submit" class="button button--small button--cart">A√±adir al carrito</button>
                  </form>
                </span>
              </summary>
              {% if grupo.resto %}
              <div class="grupo__resto" id="resto-{{ grupo.id }}">
                <div class="grupo__resto-backdrop" aria-hidden="true"></div>
                <div class="grupo__resto-panel">
                  <button type="button" class="grupo__resto-cerrar" aria-label="Cerrar">√ó</button>
                  <p class="grupo__galeria-hint">Elige una miniatura para verla arriba; haz clic en la imagen grande para verla a pantalla completa.</p>
                  <div class="grupo__grande-wrap">
                    <img class="grupo__grande grupo__grande--lightbox" src="{{ grupo.imagen_principal.url }}" alt="{{ grupo.imagen_principal.titulo }}" data-imagenes='{{ grupo.todas_urls | tojson }}' data-titulos='{{ grupo.todas_titulos | tojson }}' data-url="{{ grupo.imagen_principal.url }}" data-titulo="{{ grupo.imagen_principal.titulo }}" />
                  </div>
                  <div class="grupo__galeria" role="list">
                    <figure class="grupo__thumb grupo__thumb--selector grupo__thumb--activo" data-url="{{ grupo.imagen_principal.url }}" data-titulo="{{ grupo.imagen_principal.titulo }}" data-imagenes='{{ grupo.todas_urls | tojson }}' data-titulos='{{ grupo.todas_titulos | tojson }}'>
                      <img src="{{ grupo.imagen_principal.url }}" alt="{{ grupo.imagen_principal.titulo }}" loading="lazy" />
                      <figcaption>{{ grupo.imagen_principal.titulo }}</figcaption>
                    </figure>
                    {% for item in grupo.resto %}
                    <figure class="grupo__thumb grupo__thumb--selector" data-url="{{ item.url }}" data-titulo="{{ item.titulo }}" data-imagenes='{{ grupo.todas_urls | tojson }}' data-titulos='{{ grupo.todas_titulos | tojson }}'>
                      <img src="{{ item.url }}" alt="{{ item.titulo }}" loading="lazy" />
                      <figcaption>{{ item.titulo }}</figcaption>
                    </figure>
                    {% endfor %}
                  </div>
                </div>
              </div>
              {% endif %}
            </details>
            {% endfor %}
          </div>

          <!-- Visor de fotos en grande (lightbox) -->
          <div class="lightbox" id="lightbox" role="dialog" aria-modal="true" aria-label="Ver imagen en grande" hidden>
            <div class="lightbox__backdrop" id="lightboxBackdrop"></div>
            <div class="lightbox__content">
              <button type="button" class="lightbox__close" id="lightboxClose" aria-label="Cerrar">√ó</button>
              <button type="button" class="lightbox__prev" id="lightboxPrev" aria-label="Anterior">‚Äπ</button>
              <div class="lightbox__img-wrap">
                <img class="lightbox__img" id="lightboxImg" src="" alt="" />
              </div>
              <button type="button" class="lightbox__next" id="lightboxNext" aria-label="Siguiente">‚Ä∫</button>
              <p class="lightbox__caption" id="lightboxCaption"></p>
              <p class="lightbox__counter" id="lightboxCounter"></p>
            </div>
          </div>
        </div>
      </section>

      <!-- Elegir dise√±o -->
      <section id="elegir" class="section section--sepia">
        <div class="container">
          <header class="section__header">
            <h2>Descubre nuestro trabajo</h2>
            <p>Selecciona el dise√±o que m√°s se acerque a lo que quieres para tu encargo personalizado.</p>
          </header>
          <div class="picker" id="picker">
            {% for item in todas_imagenes %}
            <button type="button" class="picker__card" data-dise√±o="{{ item.titulo }}" data-url="{{ item.url }}" aria-pressed="false">
              <span class="picker__img-wrap"><img src="{{ item.url }}" alt="{{ item.titulo }}" loading="lazy" /></span>
              <span class="picker__label">{{ item.titulo }}</span>
            </button>
            {% endfor %}
          </div>
          <p class="picker__hint" id="pickerHint">Haz clic en una imagen para seleccionar tu dise√±o de referencia.</p>
          <p class="picker__selected" id="pickerSelected" hidden>
            Dise√±o elegido: <strong id="pickerSelectedName"></strong>
            <a href="{{ url_for('carrito') }}" class="link">Ir al carrito ‚Üí</a>
          </p>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="container footer__content">
        <p>¬© <span id="year"></span> Funko Pops Custom. Artesan√≠a hecha a mano.</p>
        <div class="footer__links">
          <a href="#!">Aviso legal</a>
          <a href="#!">Privacidad</a>
        </div>
      </div>
    </footer>

    <script>
      (function () {
        var navToggle = document.getElementById('navToggle');
        var navList = document.getElementById('navList');
        if (navToggle && navList) {
          navToggle.addEventListener('click', function () { navList.classList.toggle('nav__list--open'); });
          navList.querySelectorAll('a').forEach(function (link) {
            link.addEventListener('click', function () { navList.classList.remove('nav__list--open'); });
          });
        }
        var yearSpan = document.getElementById('year');
        if (yearSpan) yearSpan.textContent = String(new Date().getFullYear());

        var formDise√±o = document.getElementById('formDise√±o');
        var pickerHint = document.getElementById('pickerHint');
        var pickerSelected = document.getElementById('pickerSelected');
        var pickerSelectedName = document.getElementById('pickerSelectedName');
        if (document.querySelectorAll('.picker__card').length) {
          document.querySelectorAll('.picker__card').forEach(function (btn) {
            btn.addEventListener('click', function () {
              document.querySelectorAll('.picker__card').forEach(function (b) {
                b.classList.remove('picker__card--on');
                b.setAttribute('aria-pressed', 'false');
              });
              this.classList.add('picker__card--on');
              this.setAttribute('aria-pressed', 'true');
              var nombre = this.getAttribute('data-dise√±o');
              if (formDise√±o) formDise√±o.value = nombre;
              if (pickerSelectedName) pickerSelectedName.textContent = nombre;
              if (pickerHint) pickerHint.hidden = true;
              if (pickerSelected) pickerSelected.hidden = false;
            });
          });
        }

        // Lightbox: abrir visor de fotos en grande al hacer clic en portada o en una miniatura
        var lightbox = document.getElementById('lightbox');
        var lightboxImg = document.getElementById('lightboxImg');
        var lightboxCaption = document.getElementById('lightboxCaption');
        var lightboxCounter = document.getElementById('lightboxCounter');
        var lightboxClose = document.getElementById('lightboxClose');
        var lightboxBackdrop = document.getElementById('lightboxBackdrop');
        var lightboxPrev = document.getElementById('lightboxPrev');
        var lightboxNext = document.getElementById('lightboxNext');

        var lightboxImagenes = [];
        var lightboxTitulos = [];
        var lightboxIdx = 0;

        function openLightbox(url, titulo, imagenes, titulos) {
          lightboxImagenes = typeof imagenes === 'string' ? JSON.parse(imagenes) : imagenes;
          lightboxTitulos = typeof titulos === 'string' ? JSON.parse(titulos) : titulos;
          lightboxIdx = lightboxImagenes.indexOf(url);
          if (lightboxIdx < 0) lightboxIdx = 0;
          updateLightboxImage();
          if (lightbox) {
            lightbox.removeAttribute('hidden');
            lightbox.classList.add('lightbox--open');
            document.body.style.overflow = 'hidden';
          }
        }

        function closeLightbox() {
          if (lightbox) {
            lightbox.setAttribute('hidden', '');
            lightbox.classList.remove('lightbox--open');
            document.body.style.overflow = '';
          }
        }

        function updateLightboxImage() {
          if (!lightboxImagenes.length) return;
          lightboxIdx = (lightboxIdx + lightboxImagenes.length) % lightboxImagenes.length;
          var url = lightboxImagenes[lightboxIdx];
          var titulo = lightboxTitulos[lightboxIdx] || '';
          if (lightboxImg) { lightboxImg.src = url; lightboxImg.alt = titulo; }
          if (lightboxCaption) lightboxCaption.textContent = titulo;
          if (lightboxCounter) lightboxCounter.textContent = (lightboxIdx + 1) + ' / ' + lightboxImagenes.length;
          if (lightboxPrev) lightboxPrev.style.visibility = lightboxImagenes.length > 1 ? 'visible' : 'hidden';
          if (lightboxNext) lightboxNext.style.visibility = lightboxImagenes.length > 1 ? 'visible' : 'hidden';
        }

        document.querySelectorAll('.grupo__thumb--lightbox').forEach(function (thumb) {
          thumb.addEventListener('click', function () {
            var url = this.getAttribute('data-url');
            var titulo = this.getAttribute('data-titulo');
            var imgs = this.getAttribute('data-imagenes');
            var titulos = this.getAttribute('data-titulos');
            if (url && imgs) openLightbox(url, titulo, imgs, titulos);
          });
        });

        document.querySelectorAll('.grupo__thumb--selector').forEach(function (thumb) {
          thumb.addEventListener('click', function (e) {
            e.preventDefault();
            var grupo = this.closest('.grupo');
            if (!grupo) return;
            var grande = grupo.querySelector('.grupo__grande');
            var url = this.getAttribute('data-url');
            var titulo = this.getAttribute('data-titulo');
            var imgs = this.getAttribute('data-imagenes');
            var titulos = this.getAttribute('data-titulos');
            if (grande && url) {
              grande.src = url;
              grande.alt = titulo || '';
              grande.setAttribute('data-url', url);
              grande.setAttribute('data-titulo', titulo || '');
              if (imgs) grande.setAttribute('data-imagenes', imgs);
              if (titulos) grande.setAttribute('data-titulos', titulos);
            }
            grupo.querySelectorAll('.grupo__thumb--selector').forEach(function (t) { t.classList.remove('grupo__thumb--activo'); });
            this.classList.add('grupo__thumb--activo');
          });
        });

        document.querySelectorAll('.grupo__grande--lightbox').forEach(function (grande) {
          grande.addEventListener('click', function () {
            var url = this.getAttribute('data-url') || this.src;
            var titulo = this.getAttribute('data-titulo');
            var imgs = this.getAttribute('data-imagenes');
            var titulos = this.getAttribute('data-titulos');
            if (url && imgs) openLightbox(url, titulo, imgs, titulos);
          });
        });

        document.querySelectorAll('.grupo__resto-backdrop, .grupo__resto-cerrar').forEach(function (el) {
          el.addEventListener('click', function () {
            var details = this.closest('details.grupo');
            if (details) details.removeAttribute('open');
          });
        });

        if (lightboxClose) lightboxClose.addEventListener('click', closeLightbox);
        if (lightboxBackdrop) lightboxBackdrop.addEventListener('click', closeLightbox);
        if (lightboxPrev) lightboxPrev.addEventListener('click', function () { lightboxIdx--; updateLightboxImage(); });
        if (lightboxNext) lightboxNext.addEventListener('click', function () { lightboxIdx++; updateLightboxImage(); });
        document.addEventListener('keydown', function (e) {
          if (!lightbox || !lightbox.classList.contains('lightbox--open')) return;
          if (e.key === 'Escape') closeLightbox();
          if (e.key === 'ArrowLeft') { lightboxIdx--; updateLightboxImage(); }
          if (e.key === 'ArrowRight') { lightboxIdx++; updateLightboxImage(); }
        });

      })();
    </script>
  </body>
</html>
